local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")

local PlaceId = game.PlaceId

local function ServerHop()
    while true do
        local playerCount = #Players:GetPlayers() -- จำนวนคนในเซิฟเรา
        if playerCount <= 5 then
            local JobId = game.JobId -- อัพเดต JobId ปัจจุบัน
            local servers = {}

            local success, req = pcall(function()
                return game:HttpGet("https://games.roblox.com/v1/games/"..PlaceId.."/servers/Public?sortOrder=Desc&limit=100&excludeFullGames=true")
            end)

            if success and req then
                local body = HttpService:JSONDecode(req)
                if body and body.data then
                    for _, v in pairs(body.data) do
                        if type(v) == "table" then
                            local playing = tonumber(v.playing or 0)
                            local maxPlayers = tonumber(v.maxPlayers or 0)
                            local id = v.id
                            if id and playing and maxPlayers and playing < maxPlayers and playing > 5 and id ~= JobId then
                                table.insert(servers, {id = id, players = playing})
                            end
                        end
                    end
                end
            end

            if #servers > 0 then
                -- เลือกเซิฟคนเยอะที่สุด
                table.sort(servers, function(a,b) return a.players > b.players end)
                local target = servers[1].id
                print("Serverhop -> Teleporting to server with "..servers[1].players.." players")
                TeleportService:TeleportToPlaceInstance(PlaceId, target, Players.LocalPlayer)
                task.wait(5)
            else
                print("Serverhop -> No suitable server (>5 players & has space), retrying in 3s...")
                task.wait(3)
            end
        else
            -- ถ้ายังมีผู้เล่น >5 คนในเซิฟเรา รอ 5 วินาทีแล้วเช็คใหม่
            task.wait(5)
        end
    end
end

spawn(ServerHop)

loadstring(game:HttpGet("https://github.com/Generallua/Script.com/raw/refs/heads/main/Esp"))()

local fileName = "AutoRejoin.txt"

-- ฟังก์ชันอ่านค่าไฟล์
local function readValue()
    if pcall(function() readfile(fileName) end) then
        local content = readfile(fileName)
        return content == "true"
    else
        return true -- ค่าตั้งต้นถ้าไม่มีไฟล์
    end
end

-- ตั้งค่า _G.AutoRejoin
if _G.AutoRejoin == nil then
    _G.AutoRejoin = readValue()
end

-- ฟังก์ชันบันทึกค่า
local function saveValue()
    writefile(fileName, tostring(_G.AutoRejoin))
end

-- ตัวอย่างเช็คทีมและรีจอย
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local player = Players.LocalPlayer

local function checkTeam()
    if _G.AutoRejoin and player.Team and player.Team.Name == "Shark" then
        TeleportService:Teleport(game.PlaceId, player)
    end
end

-- ตรวจสอบทันที
checkTeam()

-- ตรวจสอบหลังเกิดใหม่
player.CharacterAdded:Connect(function()
    task.wait(1)
    checkTeam()
end)

-- ตรวจสอบทุกวินาที
spawn(function()
    while true do
        task.wait(1)
        checkTeam()
    end
end)

local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")
local CoreGui = game:GetService("CoreGui")

local player = Players.LocalPlayer
local filename = "sharkbite1script"

-- โหลดค่าเก่า
local statusData = {}
if pcall(function() readfile(filename) end) then
    local content = readfile(filename)
    if content ~= "" then
        statusData = HttpService:JSONDecode(content)
    end
end

-- ฟังก์ชันบันทึก
local function saveStatus(name, value)
    statusData[name] = value
    writefile(filename, HttpService:JSONEncode(statusData))
end

-- ถ้ามี GUI เก่า ลบออก
if CoreGui:FindFirstChild("CompactGUI") then
    CoreGui.CompactGUI:Destroy()
end

-- GUI หลัก
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "CompactGUI"
screenGui.Parent = CoreGui
screenGui.ResetOnSpawn = false

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 220, 0, 370)
mainFrame.Position = UDim2.new(0, 50, 0, 50)
mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 12)

local stroke = Instance.new("UIStroke", mainFrame)
stroke.Color = Color3.fromRGB(255, 255, 255)
stroke.Thickness = 2

-- Header
local header = Instance.new("Frame")
header.Size = UDim2.new(1, 0, 0, 40)
header.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
header.BorderSizePixel = 0
header.Parent = mainFrame
Instance.new("UICorner", header).CornerRadius = UDim.new(0, 12)

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -40, 1, 0)
title.Position = UDim2.new(0, 40, 0, 0)
title.BackgroundTransparency = 1
title.Text = "Shark Bite1"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.Parent = header

local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 40, 1, 0)
toggleButton.Position = UDim2.new(0, 0, 0, 0)
toggleButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.Font = Enum.Font.GothamBold
toggleButton.TextSize = 18
toggleButton.Text = "≡"
toggleButton.Parent = header
Instance.new("UICorner", toggleButton).CornerRadius = UDim.new(0, 12)

-- เนื้อหา
local bodyFrame = Instance.new("Frame")
bodyFrame.Size = UDim2.new(1, -20, 1, -60)
bodyFrame.Position = UDim2.new(0, 10, 0, 50)
bodyFrame.BackgroundTransparency = 1
bodyFrame.Parent = mainFrame

local layout = Instance.new("UIListLayout", bodyFrame)
layout.Padding = UDim.new(0, 10)
layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
layout.SortOrder = Enum.SortOrder.LayoutOrder

-- Run on respawn
local function runOnRespawn(func)
    local function runner(character)
        func()
    end
    if player.Character then runner(player.Character) end
    player.CharacterAdded:Connect(runner)
end

-- ยิงรัว interval ค่า default
local shootIntervalValue = statusData["shootInterval"] or 0.07

-- ปุ่มสร้าง
local function createButton(name, onOpenFunc, onCloseFunc)
    local button = Instance.new("TextButton")
    button.Name = name
    button.Size = UDim2.new(1, 0, 0, 40)
    button.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Font = Enum.Font.GothamBold
    button.TextSize = 16
    button.Parent = bodyFrame
    Instance.new("UICorner", button).CornerRadius = UDim.new(0, 8)

    local toggled = statusData[name] or false
    button.Text = name .. (toggled and ": ON" or ": OFF")

    button.MouseButton1Click:Connect(function()
        toggled = not toggled
        button.Text = name .. (toggled and ": ON" or ": OFF")
        saveStatus(name, toggled)
        if toggled and onOpenFunc then onOpenFunc()
        elseif not toggled and onCloseFunc then onCloseFunc() end
    end)

    if toggled and onOpenFunc then onOpenFunc() end
end

-- Safe zone
createButton("safe zone",
function()
    _G.Tp = true
    runOnRespawn(function()
        spawn(function()
            while _G.Tp do
                task.wait(0)
                if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                    player.Character.HumanoidRootPart.CFrame = CFrame.new(45.66, 251.29, 112.10)
                end
            end
        end)
    end)
end,
function()
    _G.Tp = false
    task.wait(0.1)
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        player.Character.HumanoidRootPart.CFrame = CFrame.new(17.02, 285.92, -31.10)
    end
end)

-- Shark
createButton("Shark",
function()
    _G.Shark = true
    runOnRespawn(function()
        spawn(function()
            while _G.Shark do
                task.wait(0)
                local char = player.Character
                if char and char:FindFirstChild("HumanoidRootPart") then
                    local hrp = char.HumanoidRootPart
                    local camera = workspace.CurrentCamera

                    -- ลบ clone เก่าก่อน
                    if _G.SharkClone and _G.SharkClone.Parent then
                        _G.SharkClone:Destroy()
                    end

                    local targetPos = Vector3.new(-103.03297424316406, 438.6586, 46.2111)
                    local maxDistance = 10000
                    local sharks = workspace:WaitForChild("Sharks"):GetChildren()

                    local closest, dist = nil, math.huge

                    for _, shark in ipairs(sharks) do
                        if shark:IsA("Model") then
                            local mainPart = shark.PrimaryPart or shark:FindFirstChildWhichIsA("BasePart")
                            if mainPart then
                                local d = (mainPart.Position - targetPos).Magnitude
                                if d < dist and d <= maxDistance then
                                    dist = d
                                    closest = shark
                                end
                            end
                        end
                    end

                    if closest then
                        local clone = closest:Clone()
                        clone.Parent = workspace
                        _G.SharkClone = clone

                        -- ปลด Anchored ทุก Part
                        for _, part in ipairs(clone:GetDescendants()) do
                            if part:IsA("BasePart") then
                                part.Anchored = true
                            end
                        end

                        local mainPart = clone.PrimaryPart or clone:FindFirstChildWhichIsA("BasePart")
                        if mainPart then
                            local offset = CFrame.new(0, 0, -1)
                            mainPart.CFrame = hrp.CFrame * offset

                            -- ให้เราหันไปมอง clone
                            hrp.CFrame = CFrame.new(hrp.Position, mainPart.Position)
                        end

                        spawn(function()
                            while clone.Parent do
                                if not closest.Parent then
                                    clone:Destroy()
                                    break
                                end
                                task.wait(1)
                            end
                        end)
                    end
                end
            end
        end)
    end)
end,
function() _G.Shark = false end)

-- Auto shoot
createButton("auto shoot",
function()
    _G.hit = true
    runOnRespawn(function()
        spawn(function()
            while _G.hit do
                task.wait(shootIntervalValue)
                local gui = player:FindFirstChild("PlayerGui")
                if gui and gui:FindFirstChild("WeaponDisplay") then
                    local btn = gui.WeaponDisplay.Frame:FindFirstChild("ShootButton")
                    if btn then
                        firesignal(btn.MouseButton1Click)
                        firesignal(btn.MouseButton1Down)
                        firesignal(btn.MouseButton1Up)
                        firesignal(btn.Activated)
                        firesignal(btn.TouchTap)
                    end
                end
            end
        end)
        end)
end,
function() _G.hit = false end)

-- Auto equip
createButton("auto equip",
function()
    _G.hapoon = true
    spawn(function()
        while _G.hapoon do
            task.wait(0.1)
            for _, item in ipairs(player.Backpack:GetChildren()) do
                if item:FindFirstChild("WeaponDisplay") and item.WeaponDisplay:FindFirstChild("MobileAim") then
                    task.wait(16.5)
                    if player.Character and player.Character:FindFirstChild("Humanoid") then
                        player.Character.Humanoid:EquipTool(item)
                    end
                    break
                end
            end
        end
    end)
end,
function() _G.hapoon = false end)

-- Inf ammo
createButton("inf",
function()
    _G.inf = true
    runOnRespawn(function()
        spawn(function()
            while _G.inf do
                task.wait(1)
                local aux = loadstring(game:HttpGetAsync("https://raw.githubusercontent.com/Upbolt/Hydroxide/revision/ohaux.lua"))()
                local char = player.Character or player.CharacterAdded:Wait()
                for _, item in ipairs(char:GetChildren()) do
                    if item:IsA("Tool") then
                        local localScript = item:FindFirstChildWhichIsA("LocalScript")
                        if localScript then
                            local closure = aux.searchClosure(localScript, "reload", 4, {"Enum","UserInputState","Cancel",Enum.UserInputState.Cancel,1,"script"})
                            if closure then
                                debug.setupvalue(closure, 4, 9e999)
                            end
                        end
                    end
                end
            end
        end)
    end)
end,
function() _G.inf = false end)

-- TextBox สำหรับตั้งค่าความรัวการยิง
local shootBoxLabel = Instance.new("TextLabel")
shootBoxLabel.Size = UDim2.new(1, 0, 0, 20)
shootBoxLabel.BackgroundTransparency = 1
shootBoxLabel.TextColor3 = Color3.fromRGB(255,255,255)
shootBoxLabel.Font = Enum.Font.GothamBold
shootBoxLabel.TextSize = 14
shootBoxLabel.Text = "Shoot Interval (sec)"
shootBoxLabel.Parent = bodyFrame

local shootBox = Instance.new("TextBox")
shootBox.Size = UDim2.new(1, 0, 0, 30)
shootBox.BackgroundColor3 = Color3.fromRGB(50,50,50)
shootBox.TextColor3 = Color3.fromRGB(255,255,255)
shootBox.Font = Enum.Font.Gotham
shootBox.TextSize = 16
shootBox.Text = tostring(shootIntervalValue)
shootBox.ClearTextOnFocus = false
shootBox.Parent = bodyFrame
Instance.new("UICorner", shootBox).CornerRadius = UDim.new(0,6)

shootBox.FocusLost:Connect(function(enterPressed)
    local num = tonumber(shootBox.Text)
    if num and num > 0 then
        shootIntervalValue = num
        saveStatus("shootInterval", num)
    else
        shootBox.Text = tostring(shootIntervalValue)
    end
end)

-- GUI Toggle
local collapsed = false
toggleButton.MouseButton1Click:Connect(function()
    collapsed = not collapsed
    bodyFrame.Visible = not collapsed
    mainFrame.Size = collapsed and UDim2.new(0,220,0,40) or UDim2.new(0,220,0,370)
end)

-- Drag GUI ไม่ออกนอกหน้าจอ
local dragging, dragInput, startPos, startPosFrame = false, nil, nil, nil
local function startDrag(input)
    dragging = true
    startPos = input.Position
    startPosFrame = mainFrame.Position
    input.Changed:Connect(function()
        if input.UserInputState == Enum.UserInputState.End then dragging = false end
    end)
end
header.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        startDrag(input)
    end
end)
header.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)
UserInputService.InputChanged:Connect(function(input)
    if dragging and input == dragInput then
        local delta = input.Position - startPos
        local newX = math.clamp(startPosFrame.X.Offset + delta.X, 0, workspace.CurrentCamera.ViewportSize.X - mainFrame.Size.X.Offset)
        local newY = math.clamp(startPosFrame.Y.Offset + delta.Y, 0, workspace.CurrentCamera.ViewportSize.Y - mainFrame.Size.Y.Offset)
        mainFrame.Position = UDim2.new(0, newX, 0, newY)
    end
end)

-- Shark auto teleport
_G.Sharkout = true
spawn(function()
    while _G.Sharkout do
        task.wait(1)
        if player.Team and player.Team.Name == "Shark" then
            TeleportService:Teleport(game.PlaceId, player)
        end
    end
end)
